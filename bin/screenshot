#!/bin/bash

DISPLAY=':0'

tempfile="/tmp/screenshot-$(date +%F_%T).png"
maim_opts="--nokeyboard $tempfile"

if [ -n "$1" ]; then
    case $1 in
        --window)
            maim_opts="-i $(xdotool getactivewindow) $maim_opts"
            ;;
        --select)
            maim_opts="-s $maim_opts"
            ;;
        *)
            echo "usage: $0 [--window|--select]" >/dev/stderr
            exit 1
            ;;
    esac
fi

maim $maim_opts 

img_link=$(imgurbash "$tempfile" 2>>~/screenshot_delete_links.txt)
delete_link=$(cat ~/screenshot_delete_links.txt | tail -n1)
echo img link $img_link
echo delete link $delete_link

echo $img_link | xclip -i

notify-send \
'Screenshot imgurd' \
"$img_link
$delete_link"

if [ -f "$tempfile" ]; then
    rm -rf "$tempfile"
fi

